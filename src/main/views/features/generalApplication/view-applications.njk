{% extends "claim-details-tpl-dashboard.njk" %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "../../macro/page-title.njk" import setPageTitle %}
{% from "govuk/components/details/macro.njk" import govukDetails %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "../../macro/create-table-documents.njk" import addDateUploadedFileInformation, addFileLink, createDocumentsTableWithoutTableCaption %}

{% set applicationHeaderHtml %}
  <h1 class="govuk-heading-m">{{t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.APPLICATION')}}</h1>
{% endset %}

{% set applicationHtml %}
  <div class="govuk-!-margin-bottom-9 summaryListBorderTop">
    <p class="govuk-body">{{ t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.APPLICATION_DETAILS') }}</p>
    <div class="govuk-form-group">
      {{ govukSummaryList({
        rows: summaryRows
      }) }}
    </div>
  </div>
{% endset %}

{% set responseHeaderHtml %}
  <h1 class="govuk-heading-m">{{t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.RESPONSE')}}</h1>
{% endset %}

{% set responseHtml %}
  {# TODO: add response show/hidde content here #}
  <p class="govuk-body">Response from the other parties</p>
{% endset %}

{% set courtResponseHeaderHtml %}
  <h1 class="govuk-heading-m">{{t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.RESPONSE_COURT')}}</h1>
{% endset %}

{% set applicantDocRows = [] %}
{% set respondentDocRows = [] %}
{% set courtDocRows = [] %}


{% if applicantDocuments.documents.length > 0 %}
  {% set applicantDocRows = (applicantDocRows.push([
    {
      text: t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.APPLICANTS_DOCUMENTS') | safe,
      classes: "govuk-body govuk-!-font-weight-bold"
    },
    {
      text: t(responseType)
    }
  ]), applicantDocRows) %}
  {% for item in applicantDocuments.documents %}
    {% set applicantDocRows = (applicantDocRows.push([
      {
        html: addDateUploadedFileInformation(t(item.fileName), t(item.uploadDate))
      },
      {
        html: addFileLink(item.linkInformation.url, item.linkInformation.text)
      }]), applicantDocRows) %}
  {% endfor %}
{% endif %}

{% if respondentDocuments.documents.length > 0 %}
  {% set respondentDocRows = (respondentDocRows.push([
    {
      text: t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.RESPONDENTS_DOCUMENTS') | safe,
      classes: "govuk-body govuk-!-font-weight-bold"
    },
    {
      text: t(responseType)
    }
  ]), respondentDocRows) %}
  {% for item in respondentDocuments.documents %}
    {% set respondentDocRows = (respondentDocRows.push([
      {
        html: addDateUploadedFileInformation(t(item.fileName), t(item.uploadDate))
      },
      {
        html: addFileLink(item.linkInformation.url, item.linkInformation.text)
      }]), respondentDocRows) %}
  {% endfor %}
{% endif %}

{% if courtDocuments.documents.length > 0 %}
  {% set courtDocRows = (courtDocRows.push([
    {
      text: t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.DOCUMENTS_FROM_COURT'),
      classes: "govuk-body govuk-!-font-weight-bold"
    },
    {
      text: t(responseType)
    }
  ]), courtDocRows) %}
  {% for item in courtDocuments.documents %}
    {% set courtDocRows = (courtDocRows.push([
      {
        html: addDateUploadedFileInformation(t(item.fileName), t(item.uploadDate))
      },
      {
        html: addFileLink(item.linkInformation.url, item.linkInformation.text)
      }]), courtDocRows) %}
  {% endfor %}
{% endif %}

{% set applicationDocuments %}
  <h1 class="govuk-heading-m">{{t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.APPLICATION_DOCUMENTS')}}</h1>
{% endset %}

{% set applicationDocumentsHtml %}
  {{ createDocumentsTableWithoutTableCaption(applicantDocRows) }}
  {% if applicantDocuments.documents.length > 0 %}
  {{ govukButton({
    text: t('COMMON.BUTTONS.UPLOAD_ADDITIONAL_DOCUMENTS'),
    href: additionalDocUrl
  }) }}
  {% endif %}
  {{ createDocumentsTableWithoutTableCaption(respondentDocRows) }}
  {{ createDocumentsTableWithoutTableCaption(courtDocRows) }}
{% endset %}

{% set courtResponseHtml %}
  <p class="govuk-body">{{t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.COURTS_RESPONSE')}}</p>

  {{ govukSummaryList({
    rows: responseFromCourt
  }) }}

  {% if showRequestMoreInfoButton %}
    {{ govukButton({
      text: t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.RESPOND_TO_REQUEST'),
      href: requestMoreInfoUrl
    }) }}
  {% else %}
    {{ govukButton({
      text: t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.PAY_ADDITIONAL_FEE'),
      href: payAdditionalFeeUrl
    }) }}
  {% endif %}
{% endset %}

{% set judgesDirectionsOrderHtml %}
  <p class="govuk-body">{{t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.COURTS_RESPONSE')}}</p>

  {{ govukSummaryList({
    rows: judgesDirectionsOrder
  }) }}

  {{ govukButton({
    text: 'Respond to the request',
    href: judgesDirectionsOrderUrl
  }) }}
{% endset %}


{% set judgesApproveEditDismissHtml %}
  <p class="govuk-body">{{t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.COURTS_RESPONSE')}}</p>

  {% if isJudgesApproveEdit %}
    {{ govukSummaryList({
      rows: judgesApproveEdit
    }) }}
  {% endif %}
  {% if isJudgesDismiss %}
    {{ govukSummaryList({
      rows: judgesDismiss
    }) }}
  {% endif %}

  {{ govukButton({
    text: t('COMMON.BUTTONS.CLOSE_AND_RETURN_TO_DASHBOARD'),
    href: returnDashboardUrl
  }) }}
{% endset %}

{% block nestedContent %}
  <h1 class="govuk-heading-l">{{ t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.TITLE', { applicationIndex : applicationIndex }) }}</h1>
  <p class="govuk-body">{{ t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.REVIEW') }}</p>
  <p class="govuk-body">{{ t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.SUBMITTED') }}</p>
  <p class="govuk-body">{{ t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.EITHER_PARTIES') }}</p>
  <p class="govuk-body">{{ t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.ADDITIONAL_SECTIONS') }}</p>
  <p class="govuk-body">{{ t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.UPLOAD_DOCUMENTS_1')}}<a href="{{additionalDocUrl}}">{{ t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.UPLOAD_DOCUMENTS_2') }}</a>{{t('PAGES.GENERAL_APPLICATION.VIEW_APPLICATION.UPLOAD_DOCUMENTS_3') }}</p>

  <div class="govuk-!-padding-top-5">
    {% if isResponseFromCourt %}
      {{ govukDetails({
        summaryHtml: courtResponseHeaderHtml,
        html: courtResponseHtml
      }) }}
    {% endif %}
    {% if isJudgesDirectionsOrder %}
      {{ govukDetails({
        summaryHtml: courtResponseHeaderHtml,
        html: judgesDirectionsOrderHtml
      }) }}
    {% endif %}
    {% if isJudgesApproveEdit or isJudgesDismiss %}
      {{ govukDetails({
        summaryHtml: courtResponseHeaderHtml,
        html: judgesApproveEditDismissHtml
      }) }}
    {% endif %}
    {{ govukDetails({
      summaryHtml: applicationHeaderHtml,
      html: applicationHtml
    }) }}
    {{ govukDetails({
      summaryHtml: responseHeaderHtml,
      html: responseHtml
    }) }}
    {% if (applicantDocuments.documents.length + courtDocuments.documents.length + respondentDocuments.documents.length) > 0 %}
     {{ govukDetails({
        summaryHtml: applicationDocuments,
        html: applicationDocumentsHtml
      }) }}
    {% endif %}
  </div>

  {% if isApplicationFeeAmountNotPaid %}
    {{ govukButton({
      text: t('COMMON.BUTTONS.PAY_APPLICATION_FEE'),
      href: applicationFeeOptionUrl
    }) }}
  {% else %}
    {{ govukButton({
      text: t('COMMON.BUTTONS.CLOSE_AND_RETURN_TO_DASHBOARD'),
      href: dashboardUrl
    }) }}
  {% endif %}
{% endblock %}
